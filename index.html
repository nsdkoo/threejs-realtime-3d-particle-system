<!DOCTYPE html><html lang="zh-CN"><head><meta name="x-poe-datastore-behavior" content="local_only"><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saturn Engine - äº¤äº’ç²’å­ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <style>
        body { margin: 0; background-color: #000; overflow: hidden; color: white; font-family: 'Segoe UI', sans-serif; }
        canvas { display: block; }
        .ui-panel {
            position: fixed; top: 2rem; left: 2rem; z-index: 10;
            pointer-events: none; border-left: 2px solid rgba(59, 130, 246, 0.5);
            padding-left: 1.5rem;
        }
        .status-tag {
            display: inline-block; padding: 2px 8px; border-radius: 4px;
            font-size: 10px; text-transform: uppercase; letter-spacing: 1px;
            background: rgba(59, 130, 246, 0.2); color: #60a5fa;
            margin-bottom: 0.5rem;
        }
        #cursor-hint {
            position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%);
            font-size: 12px; color: rgba(255,255,255,0.4); letter-spacing: 2px;
        }
    </style>
</head>
<body>

    <div class="ui-panel">
        <div id="mode-status" class="status-tag">åˆå§‹åŒ–ä¸­...</div>
        <h1 class="text-2xl font-thin tracking-[0.4em] uppercase">Saturn Engine</h1>
        <p class="text-[9px] text-blue-400 mt-1 opacity-60">Ultra Performance Â· 2.5K Particles</p>
        <p id="instruction" class="text-[10px] text-gray-500 mt-2 max-w-xs leading-relaxed">
            æ£€æµ‹åˆ°æœ¬åœ°ç¯å¢ƒé™åˆ¶ï¼Œå·²åˆ‡æ¢è‡³é¼ æ ‡æ§åˆ¶æ¨¡å¼ã€‚<br>
            ç§»åŠ¨é¼ æ ‡æ§åˆ¶ç²’å­ç³»ç»Ÿä½ç½®å’Œæ‰©å¼ ç¨‹åº¦ã€‚
        </p>
    </div>

    <div id="cursor-hint">MOVE TO CONTROL POSITION & EXPANSION</div>

    <!-- éšè—çš„è§†é¢‘æº -->
    <video id="input-video" class="hidden"></video>

    <script>
        let scene, camera, renderer, coreParticles;
        let expansion = 0;
        let targetExpansion = 0;
        let isUsingMouse = true;
        
        // æ‰‹åŠ¿ä½ç½®è·Ÿéš
        let targetPosition = { x: 0, y: 0 };
        let currentPosition = { x: 0, y: 0 };
        
        // ä½ç½®å¹³æ»‘ç¼“å†²ï¼ˆç”¨äºæ‰‹åŠ¿è¯†åˆ«ï¼‰- ä¼˜åŒ–ï¼šå¢åŠ ç¼“å†²åŒº
        let positionBuffer = [];
        const bufferSize = 8; // ä»5å¢åŠ åˆ°8ï¼Œæ›´å¹³æ»‘

        const modeStatus = document.getElementById('mode-status');
        const instruction = document.getElementById('instruction');

        // 1. åˆå§‹åŒ– Three.js å¼•æ“
        function initScene() {
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x000000, 200, 800); // æ·»åŠ é›¾æ•ˆ
            
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 3000);
            camera.position.z = 450; // æ›´è¿‘ä¸€ç‚¹ï¼Œä»500å‡åˆ°450

            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // é™åˆ¶æœ€å¤§åƒç´ æ¯”
            document.body.appendChild(renderer.domElement);

            // æ ¸å¿ƒç²’å­ (çƒä½“) - æ€§èƒ½ä¼˜åŒ–ç‰ˆ
            const coreCount = 2500; // è¿›ä¸€æ­¥å‡å°‘åˆ°2500
            const coreGeometry = new THREE.BufferGeometry();
            const corePos = new Float32Array(coreCount * 3);
            const coreMeta = [];

            for (let i = 0; i < coreCount; i++) {
                const r = Math.pow(Math.random(), 0.5) * 120; // å¢å¤§åŠå¾„åˆ°120
                const theta = Math.acos(2 * Math.random() - 1);
                const phi = Math.random() * Math.PI * 2;
                coreMeta.push({ r, theta, phi, speed: 0.005 + Math.random() * 0.01 });
                const idx = i * 3;
                corePos[idx] = r * Math.sin(theta) * Math.cos(phi);
                corePos[idx+1] = r * Math.sin(theta) * Math.sin(phi);
                corePos[idx+2] = r * Math.cos(theta);
            }
            coreGeometry.setAttribute('position', new THREE.BufferAttribute(corePos, 3));
            coreParticles = new THREE.Points(coreGeometry, new THREE.PointsMaterial({
                size: 3, // å¢å¤§åˆ°3
                color: 0x60a5fa, 
                transparent: true, 
                blending: THREE.AdditiveBlending, 
                opacity: 0.85, // ç¨å¾®é™ä½ï¼Œé¿å…è¿‡äº®
                sizeAttenuation: true
            }));
            scene.add(coreParticles);

            window.coreMeta = coreMeta;
        }

        // 2. äº¤äº’é€»è¾‘ (é¼ æ ‡ + æ‘„åƒå¤´é™çº§)
        function initInteraction() {
            // é¼ æ ‡ç§»åŠ¨ç›‘å¬
            window.addEventListener('mousemove', (e) => {
                if (isUsingMouse) {
                    targetExpansion = e.clientX / window.innerWidth;
                    // é¼ æ ‡æ§åˆ¶ä½ç½®
                    targetPosition.x = (e.clientX / window.innerWidth - 0.5) * 400;
                    targetPosition.y = -(e.clientY / window.innerHeight - 0.5) * 300;
                }
            });

            // å°è¯•å¯åŠ¨æ‘„åƒå¤´
            const videoElement = document.getElementById('input-video');
            const hands = new Hands({
                locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
            });

            hands.setOptions({ maxNumHands: 1, modelComplexity: 1 });
            hands.onResults((results) => {
                if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                    isUsingMouse = false;
                    modeStatus.innerText = "æ‰‹åŠ¿è¯†åˆ«æ¨¡å¼";
                    modeStatus.style.color = "#34d399";
                    const lm = results.multiHandLandmarks[0];
                    
                    // 1. å¼ åˆæ‰‹æŒæ§åˆ¶æ‰©å¼ 
                    const dist = Math.hypot(lm[4].x - lm[20].x, lm[4].y - lm[20].y);
                    targetExpansion = Math.min(1, Math.max(0, (dist - 0.05) / 0.4));
                    
                    // 2. æ‰‹æŒä½ç½®æ§åˆ¶ç²’å­ç³»ç»Ÿä½ç½®
                    // è®¡ç®—æ‰‹æŒä¸­å¿ƒï¼ˆä½¿ç”¨æ‰‹è…•0å’Œä¸­æŒ‡åŸºéƒ¨9çš„ä¸­ç‚¹ï¼‰
                    const palmCenterX = (lm[0].x + lm[9].x) / 2;
                    const palmCenterY = (lm[0].y + lm[9].y) / 2;
                    
                    // æ˜ å°„åˆ°3Dç©ºé—´ (é•œåƒxè½´ï¼Œè®©æ‰‹å¾€å³ç”»é¢å°±å¾€å³)
                    const rawX = (1 - palmCenterX - 0.5) * 400;
                    const rawY = -(palmCenterY - 0.5) * 300;
                    
                    // ä½¿ç”¨åŠ æƒç§»åŠ¨å¹³å‡è¿›è¡Œå¹³æ»‘ï¼ˆæœ€æ–°çš„å¸§æƒé‡æ›´å¤§ï¼‰
                    positionBuffer.push({ x: rawX, y: rawY });
                    if (positionBuffer.length > bufferSize) {
                        positionBuffer.shift();
                    }
                    
                    // è®¡ç®—åŠ æƒå¹³å‡ä½ç½®ï¼ˆæœ€æ–°çš„å¸§æƒé‡æ›´å¤§ï¼‰
                    let sumX = 0, sumY = 0, weightSum = 0;
                    for (let i = 0; i < positionBuffer.length; i++) {
                        const weight = i + 1; // æƒé‡ä»1åˆ°lengthé€’å¢
                        sumX += positionBuffer[i].x * weight;
                        sumY += positionBuffer[i].y * weight;
                        weightSum += weight;
                    }
                    
                    targetPosition.x = sumX / weightSum;
                    targetPosition.y = sumY / weightSum;
                }
            });

            const cameraHelper = new Camera(videoElement, {
                onFrame: async () => { await hands.send({ image: videoElement }); },
                width: 640, height: 480
            });

            cameraHelper.start().then(() => {
                isUsingMouse = false;
                positionBuffer = []; // æ¸…ç©ºç¼“å†²åŒº
                modeStatus.innerText = "æ‰‹åŠ¿è¯†åˆ«å·²å°±ç»ª";
                modeStatus.style.background = "rgba(52, 211, 153, 0.2)";
                modeStatus.style.color = "#34d399";
                instruction.innerText = "ç§»åŠ¨æ‰‹æŒæ§åˆ¶ä½ç½®ï¼Œå¼ å¼€/æ”¶æ‹¢æ‰‹æŒæ§åˆ¶æ‰©å¼ ã€‚";
            }).catch(err => {
                console.warn("Camera access denied, switching to mouse.");
                isUsingMouse = true;
                modeStatus.innerText = "é¼ æ ‡äº¤äº’æ¨¡å¼";
                instruction.innerText = "ç”±äºæµè§ˆå™¨å®‰å…¨ç­–ç•¥ï¼Œæ‘„åƒå¤´å·²ç¦ç”¨ã€‚ç§»åŠ¨é¼ æ ‡æ§åˆ¶ç²’å­ç³»ç»Ÿä½ç½®å’Œæ‰©å¼ ã€‚";
            });
        }

        // 3. åŠ¨ç”»å¾ªç¯
        function animate() {
            requestAnimationFrame(animate);

            // ç¼“åŠ¨æ•ˆæœ
            expansion += (targetExpansion - expansion) * 0.08;
            const time = Date.now() * 0.001;
            
            // ä½ç½®è·Ÿéšï¼ˆå¹³æ»‘è¿‡æ¸¡ï¼‰- ä¼˜åŒ–ï¼šæ›´è‡ªç„¶çš„ç¼“åŠ¨
            const smoothness = 0.12; // é™ä½åˆ°0.12ï¼Œæ›´æµç•…è‡ªç„¶
            currentPosition.x += (targetPosition.x - currentPosition.x) * smoothness;
            currentPosition.y += (targetPosition.y - currentPosition.y) * smoothness;

            // æ›´æ–°æ ¸å¿ƒç²’å­
            const cPos = coreParticles.geometry.attributes.position.array;
            const cMeta = window.coreMeta;
            for (let i = 0; i < cMeta.length; i++) {
                const d = cMeta[i];
                d.phi += d.speed * (1 + expansion * 2);
                const s = 1 + expansion * 4;
                const idx = i * 3;
                cPos[idx] = d.r * Math.sin(d.theta) * Math.cos(d.phi) * s;
                cPos[idx+1] = d.r * Math.sin(d.theta) * Math.sin(d.phi) * s;
                cPos[idx+2] = d.r * Math.cos(d.theta) * s;
            }
            coreParticles.geometry.attributes.position.needsUpdate = true;
            coreParticles.rotation.y += 0.002;
            coreParticles.rotation.x = Math.sin(time * 0.1) * 0.1; // æ·»åŠ è½»å¾®æ‘†åŠ¨
            
            // åº”ç”¨ä½ç½®è·Ÿéš
            coreParticles.position.x = currentPosition.x;
            coreParticles.position.y = currentPosition.y;

            renderer.render(scene, camera);
        }

        // çª—å£ç¼©æ”¾
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // å¯åŠ¨ç³»ç»Ÿ
        initScene();
        initInteraction();
        animate();
        
        // æ€§èƒ½æç¤º
        console.log('%cğŸª Saturn Engine - æè‡´æ€§èƒ½ç‰ˆ', 'color: #60a5fa; font-size: 16px; font-weight: bold;');
        console.log('%cç²’å­ä¼˜åŒ–:', 'color: #3b82f6; font-weight: bold;');
        console.log('  æ ¸å¿ƒç²’å­: 2500 (åŸ8000ï¼Œå‡å°‘69%)');
        console.log('  æ˜Ÿç¯ç²’å­: å·²ç§»é™¤ (åŸ20000)');
        console.log('  æ€»ç²’å­æ•°: 2500 (åŸ28000ï¼Œå‡å°‘91% ğŸš€)');
        console.log('%cç§»åŠ¨ä¼˜åŒ–:', 'color: #34d399; font-weight: bold;');
        console.log('  åŠ æƒç§»åŠ¨å¹³å‡: 8å¸§ç¼“å†²');
        console.log('  ç¼“åŠ¨ç³»æ•°: 0.12 (æ›´è‡ªç„¶)');
        console.log('  å¹³æ»‘ç®—æ³•: åŠ æƒå¹³å‡ (æœ€æ–°å¸§æƒé‡æ›´å¤§)');
        console.log('%cæ€§èƒ½æå‡:', 'color: #fbbf24; font-weight: bold;');
        console.log('  æ¸²æŸ“è´Ÿæ‹…: -91%');
        console.log('  é¢„è®¡å¸§ç‡: 60 FPS (ç¨³å®š)');
    </script>


</body></html>